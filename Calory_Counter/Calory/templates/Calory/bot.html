<!DOCTYPE html>
<html>
<head>
<title>AI Bot</title>

<style>

body{
  font-family:Arial;
  background:#f2f2f2;
}

.box{
  width:800px;          /* Bigger */
  margin:40px auto;
  background:white;
  padding:20px;
  border-radius:12px;
  box-shadow:0 0 10px rgba(0,0,0,0.1);
}

#chat{
  height:650px;         /* Bigger */
  border:1px solid #ccc;
  overflow-y:auto;
  padding:15px;
  background:#fafafa;
  border-radius:8px;
  margin-bottom:10px;
}

/* Message bubbles */
.user-msg{
  background:#d9ecff;
  padding:8px 12px;
  border-radius:10px;
  margin:5px 0;
  text-align:right;
}

.bot-msg{
  background:#e9ffe6;
  padding:8px 12px;
  border-radius:10px;
  margin:5px 0;
  text-align:left;
}

input{
  width:75%;
  padding:8px;
  border-radius:5px;
  border:1px solid #ccc;
}

button{
  padding:8px 14px;
  border:none;
  background:#2196f3;
  color:white;
  border-radius:5px;
  cursor:pointer;
}

button:hover{
  background:#1976d2;
}

</style>

</head>

<body>

<div class="box">

<h3>ðŸ¤– AI Bot</h3>

<div id="chat"></div>

<input id="q" placeholder="Ask anything...">
<button onclick="send()">Send</button>

<br><br>
<a href="{% url 'dashboard' %}">â¬… Back</a>

</div>


<script>

function cleanText(text){

  // Remove markdown symbols
  return text
    .replace(/\*\*/g, "")
    .replace(/###/g, "")
    .replace(/\*/g, "")
    .replace(/#/g, "")
    .replace(/\n+/g, "<br>");
}


function send(){

 let msg = document.getElementById("q").value;
 if(msg=="") return;

 let chat = document.getElementById("chat");

 chat.innerHTML += `
   <div class="user-msg">
     <b>You:</b> ${msg}
   </div>
 `;


 fetch("/bot/api/",{

   method:"POST",

   headers:{
     "Content-Type":"application/json",
     "X-CSRFToken": csrftoken
   },

   body: JSON.stringify({ text: msg })

 })

 .then(r => r.json())

 .then(d => {

   let reply = cleanText(d.reply);

   chat.innerHTML += `
     <div class="bot-msg">
       <b>Bot:</b><br>${reply}
     </div>
   `;

   chat.scrollTop = chat.scrollHeight;

 });


 document.getElementById("q").value = "";
}


// CSRF
function getCookie(name){

 let cookieValue=null;

 if(document.cookie && document.cookie!==""){

  const cookies=document.cookie.split(";");

  for(let i=0;i<cookies.length;i++){

   const cookie=cookies[i].trim();

   if(cookie.startsWith(name+"=")){

    cookieValue=decodeURIComponent(
      cookie.substring(name.length+1)
    );

    break;
   }
  }
 }

 return cookieValue;
}

const csrftoken = getCookie("csrftoken");

</script>
